(()=>{if("serviceWorker"in navigator){let e;(async()=>{e=await navigator.serviceWorker.register("./service-worker.js")})()}let e="1.0.0";fetch("https://dinoosauro.github.io/UpdateVersion/unzipify-updatecode",{cache:"no-store"}).then((t=>t.text().then((t=>{t.replace("\n","")!==e&&confirm(`There's a new version of Unzipify. Do you want to update? [${e} --\x3e ${t.replace("\n","")}]`)&&(caches.delete("unzipify-cache"),location.reload(!0))})).catch((e=>{console.error(e)})))).catch((e=>console.error(e))),document.getElementById("versionId").textContent=e;let t=new JSZip,n=[],o={items:[],ref:"",nextRef:[],nextStruct:[],structure:0,container:{nextLoadItems:[],prevLoadItems:[],currentItems:[]},search:{nextLoadItems:[],prevLoadItems:[],currentItems:[]},position:"left",isNew:!1};function improvedReader(){let e=Object.keys(n);for(let t=0;t<e.length;t++)void 0===o.items[e[t].split("/").length-1]&&(o.items[e[t].split("/").length-1]=[]),o.items[e[t].split("/").length-1].push(e[t]);document.getElementById("fileSpinner").style.display="none",showItems()}function getIfSameFolder(e,t){return t&&(e=e.substring(0,e.lastIndexOf("/"))),e=e.substring(0,e.lastIndexOf("/"))}function deleteAccidentalSlash(e){return e.endsWith("/")?e.substring(0,e.lastIndexOf("/")):e}function showItems(){let e=0;if(void 0!==o.items[o.structure+1])for(let t of o.items[o.structure+1])t.endsWith("/")&&getIfSameFolder(t,!0)===deleteAccidentalSlash(o.ref)&&(e<50?createBtn(readyValue(t),t,!0):o.container.nextLoadItems.push([t,!0]),e++);if(void 0!==o.items[o.structure])for(let t of o.items[o.structure])getIfSameFolder(t,!1)===deleteAccidentalSlash(o.ref)&&deleteAccidentalSlash(t)!==deleteAccidentalSlash(o.ref)&&(e<50?createBtn(readyValue(t),t,!1):o.container.nextLoadItems.push([t,!1]))}document.getElementById("startNew").addEventListener("click",(()=>{o.isNew=!0,document.getElementById("introduction").style.opacity=0,setTimeout((()=>{document.getElementById("introduction").style.display="none",document.getElementById("toolbar").style.display="flex",setTimeout((()=>{generateHover()}),150),setTimeout((()=>{document.getElementById("toolbar").style.opacity="1"}),15)}),250)})),document.getElementById("fileBtn").addEventListener("click",(()=>{let e=document.createElement("input");e.type="file",e.addEventListener("change",(()=>{document.getElementById("fileSpinner").style.display="block";let o=new FileReader;o.addEventListener("load",(()=>{t.loadAsync(o.result).then((e=>{document.getElementById("introduction").style.opacity=0,n=e.files,setTimeout((()=>{document.getElementById("introduction").style.display="none",document.getElementById("toolbar").style.display="flex",setTimeout((()=>{generateHover()}),150),setTimeout((()=>{document.getElementById("toolbar").style.opacity="1"}),15),improvedReader()}),250)}))})),o.readAsArrayBuffer(e.files[0])})),e.click()}));let l=document.getElementById("fileContainer");function scrollLogic(e,t,n){let l=Math.round(e.scrollTop/(e.scrollHeight-e.offsetHeight)*100);if(l>90){let l=25;l>o[t].nextLoadItems.length&&(l=o[t].nextLoadItems.length);for(let a=0;a<l;a++)void 0!==o[t].currentItems[a]&&(e.firstChild.remove(),o[t].prevLoadItems.push(o[t].currentItems[0]),o[t].currentItems.splice(0,1)),createBtn(readyValue(o[t].nextLoadItems[a][0]),o[t].nextLoadItems[a][0],o[t].nextLoadItems[a][1],void 0,n);o[t].nextLoadItems.splice(0,l)}else if(l<10){let l=25;l>o[t].prevLoadItems.length&&(l=o[t].prevLoadItems.length);for(let a=0;a<l;a++){let l=e.childNodes;0!==l.length&&(l[l.length-1].remove(),o[t].nextLoadItems.unshift(o[t].currentItems[l.length-1]),o[t].currentItems.splice(l.length-1,1)),createBtn(readyValue(o[t].prevLoadItems[o[t].prevLoadItems.length-a-1][0]),o[t].prevLoadItems[o[t].prevLoadItems.length-a-1][0],o[t].prevLoadItems[o[t].prevLoadItems.length-a-1][1],!0,n)}o[t].prevLoadItems.splice(o[t].prevLoadItems.length-l,l)}}l.addEventListener("scroll",(()=>{scrollLogic(l,"container")})),document.getElementById("searchContent").addEventListener("scroll",(()=>{scrollLogic(document.getElementById("searchContent"),"search",!0)}));let a,i={video:{extension:["mp4","mov","ogg","webm","ts"],containerFormat:document.createElement("video"),indexType:"src"},audio:{extension:["flac","mp3","opus","wav","aac","m4a","alac","weba"],mimeRefer:["audio/flac","audio/mpeg","audio/opus","audio/wav","audio/aac","audio/aac","audio/aac","audio/webm"],containerFormat:document.createElement("audio"),indexType:"src",askType:"audio/*"},image:{extension:["avif","gif","jpeg","jpg","jfif","png","svg","webp","bmp","ico","heic","heif"],containerFormat:document.createElement("img"),indexType:"src"},markdown:{extension:["md"],containerFormat:document.createElement("div"),indexType:"innerHTML"},code:{extension:["js","html","css","py","cpp","cs","applescript","bat","c","ino","erb","go","kt","lua","o","php","pl","ps1","rb","rs","vb","vba","vbs","spct","xml","sh","java","json","vbproj","vdproj","vcproj","csproj","xaml","swift"],containerFormat:document.createElement("div"),indexType:"innerHTML"},pdf:{extension:["pdf"],containerFormat:document.createElement("canvas"),indexType:"pdf"}};function cleanItems(e){o.position="left";let t=e?"search":"container";o[t].currentItems=[],o[t].nextLoadItems=[],o[t].prevLoadItems=[]}function getImg(e,t,n){if(void 0===a)return void setTimeout((()=>getImg(e,t,n)),150);void 0===a[e]&&(console.warn(`Icon not found: ${e}`),e="document");let o=getComputedStyle(document.body).getPropertyValue("--accent");void 0!==n?o=n:t.setAttribute("data-fetch",e),t.src=URL.createObjectURL(new Blob([a[e].replaceAll("#212121",o)],{type:"image/svg+xml"})),addHoverEvents(t)}document.querySelector("[data-action=back]").addEventListener("click",(()=>{document.querySelector("[data-fetch=prev]").classList.contains("disabled")||(o.container.nextLoadItems=[],o.nextRef.unshift(o.ref),o.nextStruct.unshift(o.structure),document.querySelector("[data-fetch=next]").classList.remove("disabled"),o.ref.split("/").length<=2?(o.ref="",o.structure=0,document.querySelector("[data-fetch=prev]").classList.add("disabled"),l.innerHTML=""):(o.ref=o.ref.substring(0,o.ref.length-1),o.ref=o.ref.substring(0,o.ref.lastIndexOf("/")),o.structure--,l.innerHTML=""),cleanItems(),showItems())})),fetch("./assets/mergedAssets.json").then((e=>{e.json().then((e=>{a=e})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}));let d=[null,1,document.createElement("canvas"),1],r=[];function getOptionalLibraries(e){return new Promise(((t,n)=>{-1!==r.indexOf(e)&&t(""),r.push(e);let o=document.createElement("script");o.src=e,o.setAttribute("crossorigin","anonymous"),o.onload=()=>{t("")},document.body.append(o)}))}function addAnimation(e,t){"string"==typeof e&&(e=document.getElementById(e)),e.style.opacity="1",e.style.display="block",t?e.classList.add("revDisplayDialog"):e.classList.add("displayDialog")}function PDFExtract(){let e=document.getElementById("pdfCanvas");d[0].getPage(d[1]).then((t=>{let n=t.getViewport({scale:d[3]}),o=window.devicePixelRatio||1;1!==d[3]&&(e.style=`width: ${n.width}px; height: ${n.height}px; overflow: scroll; border-radius: 8px;`),e.width=Math.floor(n.width*o),e.height=Math.floor(n.height*o);let l=1!==o?[o,0,0,o,0,0]:null,a={canvasContext:e.getContext("2d"),transform:l,viewport:n};t.render(a),document.getElementById("fileSpinner").style.display="none"})).catch((e=>{console.warn(e),document.querySelector("[data-action=prevPage]").click()}))}function moveDialog(e,t,n){document.getElementById(e).style.marginLeft="20vw",document.getElementById(e).style.position="absolute";for(let t of["top","left","right","bottom"])document.getElementById(e).style[t]="";t.getBoundingClientRect().y<60*document.body.offsetHeight/100?document.getElementById(e).style.top=`${t.getBoundingClientRect().top+15}px`:document.getElementById(e).style.bottom=`${t.getBoundingClientRect().bottom+15}px`,n.getBoundingClientRect().left<40*document.body.offsetWidth/100?document.getElementById(e).style.left=`${n.getBoundingClientRect().left+15}px`:document.getElementById(e).style.right=n.getBoundingClientRect().right-n.getBoundingClientRect().left+15+"px"}function createBtn(e,n,a,r,c){let s=document.createElement("div");s.classList.add("btnContainer"),c?s.style="width: 100%":"left"===o.position?(s.classList.add("rightMargin"),o.position="right"):(s.classList.add("leftMargin"),o.position="left");let u=document.createElement("div");u.classList.add("leftContent");let p=document.createElement("l");p.style="max-height: 30px; overflow: scroll;",p.textContent=e;let g=document.createElement("img");g.style="width: 28px; height: 28px; margin-right: 10px; cursor: auto";let f=a?"folder":"document",y={slide:["ppt","pptx","potx","pot","odt","pps","ppsx","pptm","potm","ppsm","key"],sheet:["xlsx","xls","csv","xltx","xlt","xlsm","xlsb","xltm","prn","ods","numbers"],docs:["doc","docx","rtf","txt","dotx","dot","docm","dotm","odt","pages"],pdf:["pdf","xls"],app:["exe","dmg","apk","app","dll","class","elf","jar","ipa","appx","msix","msi","bin"],folderzip:["zip","7z","gz","tar","rar","bin","lz","lzma","xz","iso","apfs"],font:["ttf","otf","abf","ttc","woff","woff1","woff2"],gaming:["wbfs","wad","wdf","gcm","nds","dsi","3ds","cia","gb","gbc","gba","n64","nes","fds","sms","smd","smc","078","sfc","fig","npc","ngp","ngc","pss","mca","nbt","map","osr","osu","ecm","cso","cdi","gdi","gen","gcz","ps2","mcr","mpk","cg","glsl","hlsl"],image:["tiff","tif","heic","heif","avif","jxr","jp2","wmf","odg","cdr","ai","dxf","heic","heif","avif","gif","jpeg","jpg","jfif","png","svg","webp","bmp","ico"],code:["js","html","css","py","cpp","cs","applescript","bat","c","ino","erb","go","kt","lua","o","php","pl","ps1","rb","rs","vb","vba","vbs","spct","xml","sh","java","json","vbproj","vdproj","vcproj","csproj","xaml","swift"],video:["mp4","mov","ogg","webm","ts"],audio:["flac","mp3","opus","wav","aac","m4a"],markdown:["md"]};for(let e in y)-1!==y[e].indexOf(n.substring(n.lastIndexOf(".")+1))&&(f=e);getImg(f,g);let h=document.createElement("div"),v=[];for(let e in i)v.push(...i[e].extension);if(-1!==v.indexOf(n.substring(n.lastIndexOf(".")+1).toLowerCase())){let e=createRightButton("eye");e.addEventListener("click",(()=>{moveDialog("previewDialog",e,g),function previewHandler(e,n){e.endsWith("pdf")?document.getElementById("pdfControlContainer").style.display="flex":document.getElementById("pdfControlContainer").style.display="none",document.getElementById("fileSpinner").style.display="block",null!==document.getElementById("jsMediaContainer").firstChild&&URL.revokeObjectURL(document.getElementById("jsMediaContainer").firstChild.src),document.getElementById("jsMediaContainer").innerHTML="",addAnimation("previewDialog",""===document.getElementById("previewDialog").style.top);let o=i[n].containerFormat;document.getElementById("fileName").textContent=e,t.file(e).async("arraybuffer").then((async t=>{switch(i[n].indexType){case"src":if(o.setAttribute("controls",""),o.classList.add("contentRespect"),document.getElementById("fileSpinner").style.display="none",void 0!==i[n].askType)"audio/*"===i[n].askType&&(o.src=URL.createObjectURL(new Blob([t],{type:i.audio.mimeRefer[i.audio.extension.indexOf(e.substring(e.lastIndexOf(".")+1))]}))),document.getElementById("fileSpinner").style.display="none";else switch(e.substring(e.lastIndexOf(".")+1)){case"svg":o.src=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),document.getElementById("fileSpinner").style.display="none";break;case"heif":case"heic":await getOptionalLibraries("./heic2any.js");let e=new Blob([t]);heic2any({blob:e}).then((e=>{o.src=URL.createObjectURL(e),document.getElementById("fileSpinner").style.display="none"}));break;default:o.src=URL.createObjectURL(new Blob([t])),document.getElementById("fileSpinner").style.display="none"}break;case"innerHTML":if(o.classList.add("textPreview"),"md"===e.substring(e.lastIndexOf(".")+1)){await getOptionalLibraries("https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js");let e=window.markdownit();o.innerHTML=e.render((new TextDecoder).decode(new Uint8Array(t)))}else o.style="white-space: pre",o.textContent=(new TextDecoder).decode(new Uint8Array(t));document.getElementById("fileSpinner").style.display="none";break;case"pdf":await getOptionalLibraries("https://cdn.jsdelivr.net/npm/pdfjs-dist@3.9.179/build/pdf.min.js"),o.id="pdfCanvas",o.style="width: 100%; height: auto; border-radius: 8px;",pdfjsLib.getDocument(t).promise.then((e=>{d[0]=e,PDFExtract()}))}document.getElementById("jsMediaContainer").append(o)}))}(n,f)})),h.append(e)}if(!c){let e=createRightButton("delete");e.addEventListener("click",(()=>{t.remove(n),refreshEntry()})),h.append(e)}h.classList.add("rightFlex");let I=createRightButton("download");if(I.addEventListener("click",(()=>{a?(moveDialog("downloadDialog",I,g),addAnimation("downloadDialog",""===document.getElementById("downloadDialog").style.top),m=n):(document.getElementById("fileSpinner").style.display="block",t.file(n).async("arraybuffer").then((t=>{downloadItem(new Blob([t]),e),document.getElementById("fileSpinner").style.display="none"})))})),u.append(g,p),h.append(I),a){let e=createRightButton("folderopen");e.firstChild.classList.add("btnMargin"),e.addEventListener("click",(()=>{document.getElementById("fileSpinner").style.display="block",cleanItems(),o.nextRef=[],o.nextStruct=[],document.querySelector("[data-fetch=next]").classList.add("disabled"),l.innerHTML="",o.structure++,o.ref=n,document.querySelector("[data-fetch=prev]").classList.remove("disabled"),c&&(document.getElementById("minimizeFetch").click(),o.structure=n.split("/").length-1),document.getElementById("fileSpinner").style.display="none",showItems()})),h.append(e)}s.append(u,h);let E=[l,"container"];c&&(E=[document.getElementById("searchContent"),"search"]),r?(E[0].prepend(s),o[E[1]].currentItems.unshift([n,a])):(E[0].append(s),o[E[1]].currentItems.push([n,a]))}function createAlert(e,t,n){if(null!==localStorage.getItem("Unzipify-noAlert")&&-1!==localStorage.getItem("Unzipify-noAlert").indexOf(`-${n}`))return;let o=document.createElement("div");o.classList.add("opacity","alert");let l=document.createElement("l");l.textContent=e;let a=document.createElement("img");a.width="28",a.height="28",a.style.marginRight="20px",getImg("alert",a,getComputedStyle(document.body).getPropertyValue("--text"));let i=document.createElement("l");function removeItem(){setTimeout((()=>{o.remove()}),210),o.style.opacity="0"}i.style.fontSize="0.8rem",i.style.textDecoration="underline",i.textContent="Don't show again",i.style.marginLeft="20px",i.style.cursor="pointer",i.addEventListener("click",(()=>{null===localStorage.getItem("Unzipify-noAlert")?localStorage.setItem("Unzipify-noAlert",`-${n}`):localStorage.setItem("Unzipify-noAlert",`${localStorage.getItem("Unzipify-noAlert")}-${n}`),removeItem()})),o.append(a,l),void 0!==t&&o.append(t),o.append(i),document.body.append(o),setTimeout((()=>{o.style.opacity="1",setTimeout((()=>{removeItem()}),parseInt(document.getElementById("alertChange").value))}),15)}function downloadItem(e,t){let n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.textContent="Force download",n.click(),n.style.marginLeft="20px",createAlert("Download started!",n,"startDownload")}function readyValue(e){return e.replace(o.ref,"")}function createRightButton(e,t,n){let o=document.createElement("div");o.classList.add("circle"),void 0!==n&&(o.style.backgroundColor=n);let l=document.createElement("img");return l.classList.add("buttonImg"),getImg(e,l,t),o.append(l),o}function removeAnimation(e){"string"==typeof e&&(e=document.getElementById(e));let t=e.classList.contains("revDisplayDialog")?"revNoDisplayDialog":"noDisplayDialog";e.classList.remove("displayDialog","revDisplayDialog"),setTimeout((()=>{e.classList.add(t),setTimeout((()=>{e.classList.remove(t),e.style.display="none"}),600)}),15)}document.querySelector("[data-action=prevPage]").addEventListener("click",(()=>{1!==d[1]&&(d[1]--,PDFExtract())})),document.querySelector("[data-action=nextPage]").addEventListener("click",(()=>{d[1]++,PDFExtract()}));for(let e of document.querySelectorAll("[data-fetch]"))getImg(e.getAttribute("data-fetch"),e);document.getElementById("minimizeInner").addEventListener("click",(()=>{document.getElementById("jsMediaContainer").innerHTML="",removeAnimation(document.getElementById("previewDialog"))}));let c=0;document.getElementById("searchItem").addEventListener("input",(()=>{c++;let e=c;setTimeout((()=>{if(e===c){cleanItems(!0),document.getElementById("fileSpinner").style.display="block";let e=o.items.flat().filter((e=>function getFileName(e){return(e=deleteAccidentalSlash(e)).substring(e.lastIndexOf("/")+1)}(e).toLowerCase().includes(document.getElementById("searchItem").value.toLowerCase())));switch(document.getElementById("checkSelect").value){case"b":e=e.filter((e=>e.toLowerCase().startsWith(o.ref.toLowerCase())));break;case"c":e=e.filter((e=>deleteAccidentalSlash(e).substring(0,deleteAccidentalSlash(e).lastIndexOf("/")).toLowerCase()===deleteAccidentalSlash(o.ref).toLowerCase()))}document.getElementById("searchContent").innerHTML="",document.getElementById("fileSpinner").style.display="none";for(let t=0;t<e.length;t++)t<50?createBtn(readyValue(e[t]),e[t],n[e[t]].dir,!1,!0):o.search.nextLoadItems.push([e[t],n[e[t]].dir])}}),150)}));let s={contentClick:[document.getElementById("minimizeFetch"),document.getElementById("tempsearch"),document.getElementById("minimizeFolder"),document.querySelector("[data-action=folderDialog]"),document.querySelector("[data-fetch=folderzip]"),document.querySelector("[data-action=addfolder]"),document.querySelector("[data-action=folderzip]"),document.getElementById("folderCreate"),document.querySelector("[data-action=downloadDialog]"),document.getElementById("minimizeDownload"),document.querySelector("[data-action=download]"),document.querySelector("[data-action=extract]"),document.querySelector("[data-action=settings]"),document.getElementById("minimizeSettings")],show:[!1,!0,!1,!0,!1,!0,!1,!1,!0,!1,!1,!1,!0,!1],ref:[document.getElementById("searchContainer"),document.getElementById("searchContainer"),document.getElementById("folderDialog"),document.getElementById("folderDialog"),document.getElementById("newFolderExclusive"),document.getElementById("newFolderExclusive"),document.getElementById("folderDialog"),document.getElementById("folderDialog"),document.getElementById("downloadDialog"),document.getElementById("downloadDialog"),document.getElementById("downloadDialog"),document.getElementById("downloadDialog"),document.getElementById("settingsDialog"),document.getElementById("settingsDialog")]};for(let e=0;e<s.contentClick.length;e++)s.show[e]?s.contentClick[e].addEventListener("click",(()=>{s.ref[e].style.position="absolute",("newFolderExclusive"!==s.ref[e].id||"newFolderExclusive"===s.ref[e].id&&!s.show[e])&&(s.ref[e].style.top=`${s.contentClick[e].getBoundingClientRect().bottom+20}px`,s.ref[e].style.left=s.contentClick[e].getBoundingClientRect().left/2+"px"),addAnimation(s.ref[e])})):s.contentClick[e].addEventListener("click",(()=>{removeAnimation(s.ref[e])}));function downloadZipItem(e){e.generateAsync({type:"blob",compression:"DEFLATE"}).then((e=>{downloadItem(e,"zip.zip"),document.getElementById("fileSpinner").style.display="none"}))}function uploadFile(e,n){let l=0;document.getElementById("fileSpinner").style.display="block",function readItem(){let a=new FileReader;a.onload=()=>{t.file(`${o.ref}${n?e[l].webkitRelativePath:e[l].name}`,new Blob([a.result]),{createFolders:!0}),l++,l<e.length?readItem():(document.getElementById("fileSpinner").style.display="none",refreshEntry(),createAlert("Added file into the ZIP!",void 0,"zipAdd"))},a.onerror=t=>{console.warn(t),createAlert(`${a.error} [${e[l].name}]`,void 0,"saveFileError"),l++,l<e.length?readItem():(document.getElementById("fileSpinner").style.display="none",refreshEntry(),createAlert("Added file into the ZIP!",void 0,"zipAdd"))},a.readAsArrayBuffer(e[l])}()}function refreshEntry(){o.isNew&&(n=t.files),cleanItems(),o.items=[],document.getElementById("fileContainer").innerHTML="",improvedReader()}document.querySelector("[data-action=addFile]").addEventListener("click",(()=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.addEventListener("change",(()=>{uploadFile(e.files)})),e.click()})),document.querySelector("[data-action=download]").addEventListener("click",(()=>{if(document.getElementById("fileSpinner").style.display="block",""===m)downloadZipItem(t);else{let e=new JSZip,n=fetchArrayPrev(),o=0;function loopAdvance(){o++,o<n.length?singleLoop():downloadZipItem(e)}function singleLoop(){""===n[o].replace(m,"")||n[o].endsWith("/")?n[o].endsWith("/")&&(e.folder(n[o].substring(0,n[o].lastIndexOf("/")).replace(m,"")),loopAdvance()):t.file(n[o]).async("arraybuffer").then((t=>{e.file(n[o].replace(m,""),new Blob([t]),{createFolders:!0}),loopAdvance()}))}singleLoop()}})),document.querySelector("[data-action=folderzip]").addEventListener("click",(()=>{let e=document.createElement("input");e.type="file";for(let t of["webkitdirectory","multiple"])e.setAttribute(t,"");e.addEventListener("change",(()=>{document.getElementById("fileSpinner").style.display="block",uploadFile(e.files,!0),document.getElementById("fileSpinner").style.display="none"})),e.click()})),document.getElementById("folderCreate").addEventListener("click",(()=>{document.getElementById("fileSpinner").style.display="block",t.folder(`${o.ref}${document.getElementById("folderName").value}`),refreshEntry(),document.getElementById("fileSpinner").style.display="none"}));let m="";function fetchArrayPrev(){return Object.keys(t.files).filter((e=>e.toLowerCase().startsWith(m.toLowerCase())))}function addHoverEvents(e){e.addEventListener("mouseover",(()=>{e.classList.contains("disabled")||(e.classList.remove("byehover"),e.classList.add("hover"))})),e.addEventListener("mouseleave",(()=>{e.classList.contains("disabled")||(e.classList.remove("hover"),e.classList.add("byehover"))}))}document.querySelector("[data-action=extract]").addEventListener("click",(async()=>{if(document.querySelector("[data-action=extract]").classList.contains("disabled"))return;document.getElementById("fileSpinner").style.display="block";let e=fetchArrayPrev(),n=await window.showDirectoryPicker();for(let o of e){let e=n,l=o;if(o=o.replace(m,""),o.split("/").length>1){let t=o.split("/");for(let n=0;n<t.length-1;n++)e=await e.getDirectoryHandle(t[n],{create:!0})}if(!o.endsWith("/")&&""!==o){let n=await e.getFileHandle(o.substring(o.lastIndexOf("/")+1),{create:!0}),a=await n.createWritable(),i=await t.file(l).async("arraybuffer");await a.write(i),await a.close()}}document.getElementById("fileSpinner").style.display="none",createAlert("Finished extracting zip file!",void 0,"zipExtractFinish")})),document.querySelector("[data-action=next]").addEventListener("click",(()=>{document.querySelector("[data-fetch=next]").classList.contains("disabled")||(document.getElementById("fileSpinner").style.display="block",l.innerHTML="",o.structure=o.nextStruct[0],o.ref=o.nextRef[0],o.nextRef.shift(),o.nextStruct.shift(),0===o.nextRef.length&&document.querySelector("[data-fetch=next]").classList.add("disabled"),document.querySelector("[data-fetch=prev]").classList.remove("disabled"),cleanItems(),document.getElementById("fileSpinner").style.display="none",showItems())})),document.querySelector("[data-action=downloadDialog]").addEventListener("click",(()=>{m=""}));for(let e of[...document.querySelectorAll("[data-change]"),...document.getElementsByClassName("button"),...document.querySelectorAll("input")])addHoverEvents(e);-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")&&document.querySelector("[data-action=extract]").classList.add("disabled");let u=[{name:"Dracula Dark",color:{text:"#fcf7f2",background:"#282a36",card:"#44475A",row:"#787b90",accent:"#34d4b2"},themeIdentifier:"a"},{name:"Simple Dark",color:{text:"#fcf7f2",background:"#191919",card:"#393939",row:"#6b6b6b",accent:"#81C784"},themeIdentifier:"b"},{name:"Simple Light",color:{text:"#171717",background:"#f5f5f5",card:"#d3d3d3",row:"#b9b9b9",accent:"#5D4037"},themeIdentifier:"c"}],p=[];if(null!==localStorage.getItem("Unzipify-customThemes"))try{p=JSON.parse(localStorage.getItem("Unzipify-customThemes"))}catch(e){console.warn(e)}function createThemeOptions(e,t){let n=document.createElement("div");n.classList.add("btnContainer","heightAnimation"),n.style="width: 100%; background-color: var(--background); max-height: 45px";let o=document.createElement("div");o.classList.add("leftContent","fillHeight");let l=document.createElement("l");l.textContent=e.name,l.classList.add("heightAnimation"),l.style="max-height: 30px; overflow: scroll;",o.append(l);let a=document.createElement("div");if(t){let t=createRightButton("delete",e.color.accent,e.color.row);t.addEventListener("click",(()=>{p.splice(p.findIndex((e=>e.themeIdentifier==e.themeIdentifier)),1),localStorage.setItem("Unzipify-customThemes",JSON.stringify(p)),n.style.maxHeight="0px",document.getElementById("themeContainer").style.maxHeight=parseInt(document.getElementById("themeContainer").style.maxHeight.replace("px",""))-60+"px",setTimeout((()=>{n.remove()}),210)})),a.append(t)}let i=createRightButton("color",e.color.accent,e.color.row);i.addEventListener("click",(()=>{checkAndApply(e)}));let d=createRightButton("download",e.color.accent,e.color.row);d.addEventListener("click",(()=>{downloadItem(new Blob([JSON.stringify(e)],{type:"application/json"}),`${e.name}-exported.json`)})),a.classList.add("rightFlex"),a.append(d,i),n.append(o,a),document.getElementById("themeContainer").append(n),document.getElementById("themeContainer").style.maxHeight=`${parseInt(document.getElementById("themeContainer").style.maxHeight.replace("px",""))+60}px`}for(let e of u)createThemeOptions(e);for(let e of p)createThemeOptions(e,!0);for(let e of document.querySelectorAll("[data-change]"))e.addEventListener("input",(()=>{document.documentElement.style.setProperty(`--${e.getAttribute("data-change")}`,e.value)}));function checkAndApply(e,t){if(void 0!==e.color){for(let t in e.color)/^#[0-9A-F]{6}$/i.test(e.color[t])&&(document.documentElement.style.setProperty(`--${t}`,e.color[t]),null!==document.querySelector(`[data-change=${t}]`)&&(document.querySelector(`[data-change=${t}]`).value=e.color[t]));t||localStorage.setItem("Unzipify-currentTheme",JSON.stringify(e));for(let e of document.querySelectorAll("[data-fetch]"))getImg(e.getAttribute("data-fetch"),e)}}document.getElementById("saveTheme").addEventListener("click",(()=>{let e=prompt("Choose a name for this new theme:");if(void 0===e)return;let t={name:e,color:{},themeIdentifier:(new Date).toISOString()};for(let e of document.querySelectorAll("[data-change]"))t.color[e.getAttribute("data-change")]=e.value;p.push(t),localStorage.setItem("Unzipify-customThemes",JSON.stringify(p)),createThemeOptions(t,!0),checkAndApply(t)})),null!==localStorage.getItem("Unzipify-currentTheme")?checkAndApply(JSON.parse(localStorage.getItem("Unzipify-currentTheme"))):checkAndApply(u[1]),document.getElementById("importTheme").addEventListener("click",(()=>{let e=document.createElement("input");e.type="file",e.onchange=()=>{let t=new FileReader;t.onload=()=>{checkAndApply(JSON.parse(t.result),!0),createAlert("Theme imported! Make sure to save it so that you won't need to import it again",void 0,"importedTheme")},t.readAsText(e.files[0])},e.click()})),document.querySelector("[data-change=accent]").addEventListener("change",(()=>{for(let e of document.querySelectorAll("[data-fetch]"))getImg(e.getAttribute("data-fetch"),e)})),document.getElementById("alertChange").addEventListener("input",(()=>{localStorage.setItem("Unzipify-alertDuration",document.getElementById("alertChange").value)}));let g,f={localItem:["Unzipify-alertDuration"],ref:[document.getElementById("alertChange")],changeType:["value"]};for(let e=0;e<f.localItem.length;e++)null!==localStorage.getItem(f.localItem[e])&&(f.ref[e][f.changeType[e]]=localStorage.getItem(f.localItem[e]));function generateHover(){document.getElementById("hoverContainer").innerHTML="";for(let e of document.querySelectorAll("[data-hover]")){let t=document.createElement("div");t.classList.add("hoverDialog"),t.style.top=`${e.getBoundingClientRect().bottom+15}px`,t.style.left=`${e.getBoundingClientRect().left+15}px`;let n=document.createElement("div");n.classList.add("hoverContainer");let o=document.createElement("l");o.textContent=e.getAttribute("data-hover"),e.addEventListener("mouseenter",(()=>{t.style.display="block",setTimeout((()=>{t.style.opacity="1"}),15)})),e.addEventListener("mouseleave",(()=>{setTimeout((()=>{t.style.display="none"}),210),t.style.opacity="0"})),n.append(o),t.append(n),document.getElementById("hoverContainer").append(t)}}document.getElementById("openSource").addEventListener("click",(()=>{fetch("./OpenSource.md").then((e=>{e.text().then((e=>{getOptionalLibraries("https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js").then((()=>{let t=window.markdownit();document.getElementById("openSourceDiv").innerHTML=t.render(e)}))}))}))})),-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")&&(document.getElementById("safariStyle").innerHTML=`select {-webkit-appearance: none; background-image: url("data:image/svg+xml;utf8,<svg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='24' height='24' viewBox='0 0 24 24'><path fill='${getComputedStyle(document.body).getPropertyValue("--text").replace("#","%23")}' d='M7.406 7.828l4.594 4.594 4.594-4.594 1.406 1.406-6 6-6-6z'></path></svg>"); background-position: 100% 50%; background-repeat: no-repeat; font-size: 10pt}`),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),g=e})),document.getElementById("pwaBtn").addEventListener("click",(()=>{g.prompt(),g.userChoice.then((e=>{"accepted"===e.outcome&&(document.getElementById("pwaTab").style.display="none")}))})),window.matchMedia("(display-mode: standalone)").matches&&(document.getElementById("pwaTab").style.display="none")})();